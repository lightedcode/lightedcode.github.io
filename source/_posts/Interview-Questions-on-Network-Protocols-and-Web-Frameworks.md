---
title: Interview Questions on Network Protocols and Web Frameworks
date: 2024-08-03 22:31:04
cover_image: /image/cover005.png
cover_image_alt: AI LOGO Network
tags:
    - Network
    - Interview
    - Web
categories:
    - Code
---

# 浏览器输入一个url中间经历的过程
- 中间涉及到了哪些过程
- 包含哪些网络协议
- 每个协议都干了什么

1. **URL 解析**
   - 浏览器解析用户输入的 URL，拆分出协议、主机名、端口、路径、查询参数等部分。

2. **检查浏览器缓存**
   - 浏览器首先检查本地缓存是否有对应的资源，如果有且未过期，直接返回缓存内容。

3. **DNS 解析**
   - **DNS 缓存检查**：浏览器检查本地 DNS 缓存、操作系统缓存、路由器缓存等。
   - **Host 文件检查**：操作系统检查本地的 Hosts 文件。
   - **DNS 查询**：如果缓存中没有找到，浏览器向 DNS 服务器发起查询请求，得到目标服务器的 IP 地址。

4. **建立 TCP 连接**
   - **TCP 三次握手**：浏览器与服务器之间通过三次握手建立 TCP 连接。

5. **发送 HTTP 请求**
   - 浏览器构建 HTTP 请求报文，并通过建立的 TCP 连接发送给服务器。

6. **服务器处理请求**
   - **反向代理服务器（如 Nginx）**：接收请求并根据配置决定如何处理（如负载均衡、静态资源处理等）。
   - **应用服务器（如 WSGI 服务器）**：将请求转发给应用程序（如 Flask、Django）。
   - **Web 框架**：应用程序处理请求，可能涉及数据库查询、业务逻辑处理等，生成响应。

7. **服务器返回响应**
   - 应用服务器将生成的响应通过反向代理服务器返回给浏览器。

8. **浏览器渲染页面**
   - **解析 HTML**：浏览器解析 HTML 文档，生成 DOM 树。
   - **解析 CSS**：构建 CSSOM 树。
   - **解析 JavaScript**：执行脚本，可能会修改 DOM 树和 CSSOM 树。
   - **合成页面**：将 DOM 树和 CSSOM 树合成渲染树，绘制页面。

9. **TCP 连接关闭**
   - **TCP 四次挥手**：浏览器和服务器之间通过四次挥手关闭 TCP 连接。

# TCP三次握手
三次握手的设计是为了确保双方都能够可靠地知道对方的存在，并且双方的发送和接收能力都是正常的。
1. 客户端发送SYN报文，表示想要建立链接，包含SN序列号
2. 服务端收到后，想客户端发送SYN-ACK确认报文，表示我收到你的请求了，并包含SN序列号
3. 客户端收到确认报文后，向服务端发送ACK确认报文，表示收到服务器的确认报文，此时链接建立

![](001.png)

## 为什么不是二次握手或者四次握手
- **两次握手的问题**：
  - 如果采用两次握手，可能会导致“已失效的连接请求报文段”被服务器误认为是一个新的连接请求。例如，客户端发送第一个 SYN 报文后，由于网络问题该报文长时间滞留在网络中，客户端没有收到服务器的 SYN-ACK 报文，认为连接失败，于是再次发送 SYN 报文并成功建立连接。此时，旧的 SYN 报文到达服务器，服务器会误以为客户端又发起了一个新的连接，从而同意连接并发送 SYN-ACK 报文。这样服务器就会建立一个无用的连接，浪费资源。
- **四次握手的冗余**：
  - 四次握手并不是必要的，因为三次握手已经可以确保双方都能正常发送和接收数据。增加一次握手并不会带来更多的确认信息，反而会增加连接建立的时间和复杂性。

# TCP四次挥手
四次挥手的设计是为了确保双方都能可靠地结束数据传输，并且双方都确认对方已经关闭连接。
1. 客户端向服务端发送FIN(结束)报文，表示客户端没有数据要发送了，但是可以接收数据
2. 服务端收到FIN报文后，向客户端发送一个ACK确认报文，此时服务端进入**关闭等待**状态，但仍然可以发送数据给客户端
3. 服务端向客户端发送FIN报文，表示服务端也没有数据要发送了
4. 客户端收到FIN报文后，向服务端发送一个ACK确认报文，表示收到了服务端的结束报文。此时客户端进入**时间等待**状态，确保服务器能收到这个ACK报文，之后姐可以关闭链接

![](002.png)

## 为什么需要四次挥手
1. **全双工通信的关闭**：
   - TCP 连接是全双工的，即双方都可以同时发送和接收数据。因此，关闭连接需要确保双方的数据传输都已经结束。
   - 第一次挥手：客户端发送 FIN，表示客户端的数据发送已经结束。
   - 第二次挥手：服务器收到 FIN 后发送 ACK，确认客户端的数据发送已经结束。
   - 第三次挥手：服务器发送 FIN，表示服务器的数据发送也已经结束。
   - 第四次挥手：客户端收到 FIN 后发送 ACK，确认服务器的数据发送也已经结束。

2. **防止数据丢失**：
   - 四次挥手确保双方都有机会发送和接收最后的数据，避免数据丢失。
   - 服务器在收到客户端的 FIN 后，可能还有未发送完的数据，因此需要发送 ACK 确认，并在数据发送完后再发送 FIN。

### 为什么不能三次挥手？

- **三次挥手的问题**：
  - 如果采用三次挥手，可能会导致数据丢失。例如，如果客户端发送 FIN 后，服务器立即发送 FIN 而不发送 ACK 确认客户端的 FIN，客户端可能会误以为服务器的数据发送已经结束，从而关闭连接，导致服务器未发送完的数据丢失。

- **四次挥手的必要性**：
  - 四次挥手确保了双方都能完全关闭连接，并且都确认对方已经关闭连接，避免数据丢失和连接异常。

# TCP和UDP的区别


